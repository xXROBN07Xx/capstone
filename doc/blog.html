<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robert Zhong">

<title>Overview of British Colombia EMS activity (2009-2014)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="blog_files/libs/clipboard/clipboard.min.js"></script>
<script src="blog_files/libs/quarto-html/quarto.js"></script>
<script src="blog_files/libs/quarto-html/popper.min.js"></script>
<script src="blog_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="blog_files/libs/quarto-html/anchor.min.js"></script>
<link href="blog_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="blog_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="blog_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="blog_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="blog_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#bcehs-activity-2009-2014" id="toc-bcehs-activity-2009-2014" class="nav-link active" data-scroll-target="#bcehs-activity-2009-2014">BCEHS activity 2009-2014</a>
  <ul class="collapse">
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing:</a></li>
  <li><a href="#temporal-patterns" id="toc-temporal-patterns" class="nav-link" data-scroll-target="#temporal-patterns">Temporal Patterns:</a></li>
  <li><a href="#from-call-to-hospital" id="toc-from-call-to-hospital" class="nav-link" data-scroll-target="#from-call-to-hospital">From Call to Hospital:</a></li>
  <li><a href="#forecasting-elapsed-times" id="toc-forecasting-elapsed-times" class="nav-link" data-scroll-target="#forecasting-elapsed-times">Forecasting Elapsed Times:</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="..\blog.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Overview of British Colombia EMS activity (2009-2014)</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Spring 2024</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Robert Zhong </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="bcehs-activity-2009-2014" class="level1">
<h1>BCEHS activity 2009-2014</h1>
<p><img src="https://th.bing.com/th/id/OIG3.fShD12tDxLSbu1nrvUnW?w=1024&amp;h=1024&amp;rs=1&amp;pid=ImgDetMain" class="img-fluid" alt="BCEHS"> Suppose someone is enjoying their day, maybe sipping on a cup of tea, when suddenly, life throws them a curveball, and they find themselves in need of medical assistance. In those moments, the efficiency of the EMS can make all the difference between a happy ending and a not so happy one, depending on how one views it. There are some people who wonder what goes on behind the scenes and what factors influence efficiency. This article explores British Columbia’s EMS department, the largest provider of emergency healthcare in Canada and the second-busiest EMS service in North America. Using data from the Provincial Health Services Authority, I will explore the factors that contribute to the efficiency of the EMS in British Columbia.and find more information on how these various operational and logistical elements impact overall EMS efficiency and patient outcomes in British Columbia. Identifying strengths, weaknesses, and areas for improvement could help inform best practices for other major EMS providers as well.</p>
<section id="preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing">Preprocessing:</h2>
<div id="afa1d327" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> make_scorer</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\rzhon\AppData\Local\Temp\ipykernel_12868\1436662149.py:16: DtypeWarning:

Columns (3,6) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
</div>
<div id="398248f4" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop\Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing duplicate values for resposne mode intital</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Response_Mode_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Response_Mode_Initial'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing duplicate values for resposne mode final</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Response_Mode_Final'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Response_Mode_Final'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Response_Mode_Final'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Det_Code_Init'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Det_Code_Init'</span>].isin([<span class="st">'.'</span>])]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\rzhon\AppData\Local\Temp\ipykernel_12868\876954086.py:1: DtypeWarning:

Columns (3,6) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
</div>
<div id="e426bc7b" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing descriptions</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> pd.read_excel(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data\MPDS_Codes_and_RAP_Changes.xlsx"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>mpds_codes.columns <span class="op">=</span> [c.strip() <span class="cf">for</span> c <span class="kw">in</span> mpds_codes.columns]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.<span class="bu">apply</span>(<span class="kw">lambda</span> col: col.<span class="bu">str</span>.strip() <span class="cf">if</span> col.dtype <span class="op">==</span> <span class="st">"object"</span> <span class="cf">else</span> col)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganize</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.iloc[<span class="dv">2</span>:].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>mpds_codes.columns <span class="op">=</span> mpds_codes.iloc[<span class="dv">0</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes[<span class="dv">1</span>:].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.rename(columns<span class="op">=</span>{<span class="st">'MPDS Code'</span>: <span class="st">'MPDS_Code'</span>, <span class="st">'Description'</span>: <span class="st">'Description'</span>})</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>mpds_codes[<span class="st">'MPDS_Code'</span>] <span class="op">=</span> mpds_codes[<span class="st">'MPDS_Code'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>mpds_codes[<span class="st">'MPDS_Code'</span>] <span class="op">=</span> mpds_codes[<span class="st">'MPDS_Code'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add descriptions to ambulance_raw dataframe</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>joined_df <span class="op">=</span> ambulance_raw.merge(mpds_codes, how<span class="op">=</span><span class="st">'inner'</span>, left_on<span class="op">=</span><span class="st">'MPDS_Code_Final'</span>, right_on<span class="op">=</span><span class="st">'MPDS_Code'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="temporal-patterns" class="level2">
<h2 class="anchored" data-anchor-id="temporal-patterns">Temporal Patterns:</h2>
<p>By examining response times across different years, I uncover the ebb and flow of emergency calls. Moreover, I will investigate the impact of community type on response times, shedding light on the challenges faced by different communities.</p>
<div id="cell-F1" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>commonincidents <span class="op">=</span> joined_df[<span class="st">'Description'</span>].value_counts().head(<span class="dv">10</span>).index</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>top10 <span class="op">=</span> joined_df[joined_df[<span class="st">'Description'</span>].isin(commonincidents)]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get average response time for each year and description</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>avg_response_time <span class="op">=</span> top10.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Description'</span>])[<span class="st">'Resp_Time'</span>].mean().unstack()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> description <span class="kw">in</span> commonincidents:</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(avg_response_time.index, avg_response_time[description], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>description)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Response Time (minutes)'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Response Time by Call Year for Top 10 Most Common Incidents'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Most Common Initial Call Cases (Top 10)'</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="fl">.8</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f1-output-1.png" id="f1" width="1425" height="671" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>“TRANSFER- ACUITY I (No priority symptoms)” means that the patient is being transferred between healthcare facilities, their condition is stable, and they do not have any symptoms that would require a higher priority transfer. This type of transfer is generally not considered an emergency and may be scheduled in advance.</p>
<div id="cell-F2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure time is poitive number</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Resp_Time'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'Community_Type'</span>, y<span class="op">=</span><span class="st">'Resp_Time'</span>, data<span class="op">=</span>ambulance_raw)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Time Across Different Types of Communities'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Response Time (min)'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('FinalProjPoster2.svg', format='svg')</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f2-output-1.png" id="f2" width="965" height="643" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From the boxplots, No-station communities usually have to wait a longer period for first responders to arrive. The population density is low and there is no dedicated police station or full-time law enforcement officers stationed within the community. Due to the distance between the community and the nearest police station, response times for emergency services may be longer. The cases that need more attention have a faster response time. Predominantly, the incidents revolve around respiratory difficulties and falls. These times have remained very consistent over the years. Some of the cases that are more severe are like automobiles where dirty oils/fluids and air filters are not given priority, then they start getting sick and problems occur. Same happens with tropical storms when they don’t have access to warm waters and moist air.</p>
<div id="cell-F3" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.hist(ambulance_raw[<span class="st">'Community_Type'</span>], bins<span class="op">=</span><span class="dv">5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Type of Community'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency(millions)'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of EMS events through different Communties'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f3-output-1.png" id="f3" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The amount of cases in Remote and No-Station areas is minimal. Metro areas have the most cases usually because of the population density, along with more infrastructure and pollution. Furthermore, the amounts of cases have been increasing over the years for metro and urban communities.</p>
<div id="cell-F4" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>community_types <span class="op">=</span> [<span class="st">'Metro'</span>, <span class="st">'Urban'</span>, <span class="st">'Rural'</span>, <span class="st">'Remote'</span>, <span class="st">'No-Station'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year and community type</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> community_type <span class="kw">in</span> community_types:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    community_data <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Community_Type'</span>] <span class="op">==</span> community_type]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    call_frequencies <span class="op">=</span> community_data.groupby(<span class="st">'Call_Year'</span>).size()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    call_frequencies.plot(kind<span class="op">=</span><span class="st">'line'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>community_type)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Emergency Cases Over Time (2009-2014)'</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f4-output-1.png" id="f4" width="949" height="564" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Rural, Remote, and No-station areas have a fairly consistent amount of calls annually. The less people, the less things change over time. ## Decoding the Incident: The nature of the call and its assigned priority can greatly affect response times. I examine the variety of call types and their associated response times, and explore the relationship between initial and final call codes. Sometimes, the initial assessment of an emergency might differ from the final diagnosis. I also assess the impact of changes to the Resource Allocation Plan on call prioritization.</p>
<div id="cell-F5" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>top_20 <span class="op">=</span> joined_df[<span class="st">'Description'</span>].value_counts().head(<span class="dv">20</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>top_20.plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Incident'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 20 Most Common EMS Cases'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f5-output-1.png" id="f5" width="982" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is a more in depth part of <span class="citation" data-cites="F1">(<a href="#ref-F1" role="doc-biblioref"><strong>F1?</strong></a>)</span>. Some of the cases are very common. In BC, injuries from falls and transport incidents have resulted in the highest number of years lived with disability, while unintentional poisoning and injuries from self-harm have resulted in the highest number of years of life lost, with the gross cost per disability-adjusted life years for these causes ranging from $547 million to $922 million. BC’s diverse landscape includes mountains, forests, and coastal regions, leading to various outdoor activities and potential risks. The residents often engage in outdoor activities such as hiking, skiing, and cycling, which come with inherent injury risks, with peak injury months being August and September. According to B.C’s provincial trauma registry, of the five popular winter sports, the greatest amount of injuries leading to hospitalization in British Columbia happen to skiers and snowboarders.Transport incidents are also prevalent partly due to the high volume of traffic on British Columbia’s roads, particularly in metro and urban areas. Due to colder climates, some diseases could spread easier which can lead to illness. Fainting could be due to illness; It can also be due to unintentional poisoning one way or another.</p>
<div id="f6" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Getting percent change between inital and final, then making pie charts</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>responsechangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'Response_Mode_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>mpdschangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'MPDS_Code_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>determinantchangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'Det_Code_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'No Change'</span>, <span class="st">'Change'</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'lightcoral'</span>, <span class="st">'lightskyblue'</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>explode <span class="op">=</span> (<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> responsechangepercentage, responsechangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Change Percentage'</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> mpdschangepercentage, mpdschangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MPDS Change Percentage'</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> determinantchangepercentage, determinantchangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Determinant Change Percentage'</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f6-output-1.png" id="f6-1" width="360" height="335" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f6-output-2.png" id="f6-2" width="327" height="335" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f6-output-3.png" id="f6-3" width="353" height="335" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-F7" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of avg resp time between changed and unchanged cases</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'code_change'</span>] <span class="op">=</span> ambulance_raw.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No Change'</span> <span class="cf">if</span> x[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">==</span> x[<span class="st">'MPDS_Code_Final'</span>] <span class="cf">else</span> <span class="st">'Changed'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>avgresponsebychange <span class="op">=</span> ambulance_raw.groupby(<span class="st">'code_change'</span>)[<span class="st">'To_Hosp'</span>].mean().reset_index()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>avgresponsebychange.columns <span class="op">=</span> [<span class="st">'code_change'</span>, <span class="st">'avg_response_time'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>avgresponsebychange, x<span class="op">=</span><span class="st">'code_change'</span>, y<span class="op">=</span><span class="st">'avg_response_time'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Effect of Code Change on Time to Hospital'</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Code Change'</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Time to Hospital (min)'</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.despine()</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f7-output-1.png" id="f7" width="808" height="671" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Call types can change if the corresponding call is accually different from what was initially reported. There is a small portion of changes between Initial and Final MPDS codes. MPDS Codes are a subset of Determinant codes so it makes sense there is a slight bit more change. The difference between the time it takes to get to the hospital is a bit higher with change, but its not really noticeable.</p>
<div id="cell-F8" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouped bar plot of frequenct of reponse codes over the years.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>frequencydata <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Mode_Initial'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pivot_table <span class="op">=</span> frequencydata.pivot(index<span class="op">=</span><span class="st">'Call_Year'</span>, columns<span class="op">=</span><span class="st">'Response_Mode_Initial'</span>, values<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pivot_table.plot(kind<span class="op">=</span><span class="st">'bar'</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Calls (2009-2014) by Response Code'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Code'</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f8-output-1.png" id="f8" width="991" height="671" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>[Code 3 = Lights and Sirens; Code 2 = Lights w/o Sirens; Code 1 = No Lights and Sirens] On October 2013, BCEHS implemented a revised EMS resource allocation plan. This plan was designed to optimize the allocation of resources by prescribing the paramedic qualification that should respond and at what speed, as well as the associated potential first responder attendance for a given 911 call. This includes 74 incident codes that were reclassified from Code 2 to Code 3 calls. These modifications to call prioritization can have a significant impact on how emergency resources are deployed. I’ll assess the effect of these changes on response times and call prioritization. In <span class="citation" data-cites="F8">(<a href="#ref-F8" role="doc-biblioref"><strong>F8?</strong></a>)</span>, There is a noticeable increase in Response times from 2013-2014. The revision aimed to improve the appropriateness of responses to emergency calls, ensuring that resources were matched more effectively to the needs of the call.</p>
<div id="f9" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bubble plots</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>location_grp <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Community_Type'</span>,<span class="st">'Response_Mode_Initial'</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>location_grp_ct <span class="op">=</span> location_grp[<span class="st">'MPDS_Code_Initial'</span>].count().reset_index()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ax.scatter(location_grp_ct[<span class="st">'Community_Type'</span>], location_grp_ct[<span class="st">'Response_Mode_Initial'</span>], s<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>]<span class="op">*</span><span class="fl">.005</span>, c<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Response Code'</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Event types by Community and Response Codes'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>location_grp <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Community_Type'</span>,<span class="st">'Det_Code_Init'</span>])</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>location_grp_ct <span class="op">=</span> location_grp[<span class="st">'MPDS_Code_Initial'</span>].count().reset_index()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>ax.scatter(location_grp_ct[<span class="st">'Community_Type'</span>], location_grp_ct[<span class="st">'Det_Code_Init'</span>], s<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>]<span class="op">*</span><span class="fl">.005</span>, c<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Det Code'</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Event types by Community and Det Codes'</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f9-output-1.png" id="f9-1" width="799" height="671" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f9-output-2.png" id="f9-2" width="801" height="671" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>(Note: Here are what each Determinant Codes represent respectively[Alpha: Typically involves non-life-threatening situations; Bravo: Conditions that require prompt, but not immediate care; Charlie: Significant injuries or symptoms; Delta: Represents a life-threatening emergency; Echo: High probability of immediate life-threat; Omega: For incidents that are non-life-threatening and may not need immediate medical intervention]) The bubble plots above are a more in depth look at <span class="citation" data-cites="F3">(<a href="#ref-F3" role="doc-biblioref"><strong>F3?</strong></a>)</span>. It shows the distribution of different cases across different communities, response codes, and determination codes. The bigger and lighter a bubble is, the larger number of cases there are. The smaller and darker the bubble is, the smaller number of cases there are. The plots show that the amount of cases are proportional across the x-axis(Community Type) and y-axis(response code and determination code). There is nothing out of the ordinary. Overall, Responding code 3 is the most common and the cases with Determinant Codes A,B,C, and D are the most frequent. There’s not much of Determinant code E which is the most severe.</p>
</section>
<section id="from-call-to-hospital" class="level2">
<h2 class="anchored" data-anchor-id="from-call-to-hospital">From Call to Hospital:</h2>
<p>Dissecting the emergency response process, the analysis focuses on the various components that contribute to the overall response time. By examining the time elapsed from ambulance dispatch to on-scene arrival, and on-scene arrival to hospital arrival.</p>
<div id="f10" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time distribution</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(ambulance_raw[<span class="st">'Resp_Time'</span>], bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Response Times'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time (min)'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="f10-1" class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Text(0, 0.5, 'Frequency')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f10-output-2.png" id="f10-2" width="994" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What I noticed is that the response times from the call dispatch to when the emergency crew arrives on scene takes the shape of a normal distribution with a slight right skew. The vast portion is 10 minutes and less.</p>
<div id="cell-F11" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ambulance_raw2 <span class="op">=</span> ambulance_raw</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mbulance_raw2 <span class="op">=</span> ambulance_raw.drop(ambulance_raw[(ambulance_raw[<span class="st">'To_Hosp'</span>].isnull()) <span class="op">|</span> (ambulance_raw[<span class="st">'Resp_Time'</span>].isnull())].index)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ambulance_raw2[<span class="st">'TimeDifference'</span>] <span class="op">=</span> ambulance_raw2[<span class="st">'To_Hosp'</span>] <span class="op">-</span> ambulance_raw2[<span class="st">'Resp_Time'</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> ambulance_raw2.select_dtypes(include<span class="op">=</span><span class="st">'number'</span>).columns:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>((ambulance_raw2[col] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ambulance_raw2[col] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        ambulance_raw2 <span class="op">=</span> ambulance_raw2[ambulance_raw2[col] <span class="op">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'Resp_Time'</span>, y<span class="op">=</span><span class="st">'TimeDifference'</span>, data<span class="op">=</span>ambulance_raw2, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.polyfit(ambulance_raw2[<span class="st">'Resp_Time'</span>], ambulance_raw2[<span class="st">'TimeDifference'</span>], <span class="dv">1</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.plot(ambulance_raw2[<span class="st">'Resp_Time'</span>], p(ambulance_raw2[<span class="st">'Resp_Time'</span>]), <span class="st">"r--"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Time on Scene vs Time on scene to Hospital'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time to Scene (min)'</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Time from scene to Hospital (min)'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0
0
13
1045</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f11-output-2.png" id="f11" width="828" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><span class="citation" data-cites="F11">(<a href="#ref-F11" role="doc-biblioref"><strong>F11?</strong></a>)</span> above shows a scatterplot between Response Time to Scene and the elapsed time from when the EMS crew arrives on scene to when the crew arrives at the hospital. The plot does good showing patterns and outliers. There are so many observations that the data points can overlap so it’s not great at identifying potential clusters. The outliers for the time from scene to hospital all have a high amount of minutes which could indicate inaccurate data entry or unusual/rare cases.</p>
<div id="cell-F12" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Time_Category'</span>] <span class="op">=</span> pd.cut(ambulance_raw[<span class="st">'Resp_Time'</span>],</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                                  bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">10</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                                 labels<span class="op">=</span>[<span class="st">'&lt;10 min'</span>, <span class="st">'&gt;=10 min'</span>])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>response_time_ct <span class="op">=</span> ambulance_raw.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Time_Category'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>response_time_ct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), color<span class="op">=</span>[<span class="st">'green'</span>, <span class="st">'red'</span>])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Yearly Calls by Response Times(2009-2014)'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Amount of Calls'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Time'</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f12-output-1.png" id="f12" width="945" height="560" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-F13" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>echo_calls <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">==</span> <span class="st">'E'</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>echo_calls[<span class="st">'Response_Time_Category'</span>] <span class="op">=</span> pd.cut(echo_calls[<span class="st">'Resp_Time'</span>],</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                              bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">10</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                              labels<span class="op">=</span>[<span class="st">'&lt;10 min'</span>, <span class="st">'&gt;=10 min'</span>])</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>response_time_ct <span class="op">=</span> echo_calls.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Time_Category'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>response_time_ct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), color<span class="op">=</span>[<span class="st">'green'</span>, <span class="st">'red'</span>])</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution Echo Calls by Response Time Category'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Amount of Calls'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Time Category'</span>, loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\rzhon\AppData\Local\Temp\ipykernel_12868\606239621.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f13-output-2.png" id="f13" width="944" height="560" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The bar plots indicates that amount of calls are going up over the years which aligns with <span class="citation" data-cites="F4">(<a href="#ref-F4" role="doc-biblioref"><strong>F4?</strong></a>)</span>. The response time for Echo calls, which are the most urgent ones, generally on average always have faster response times proportionally than the overall amount of calls combined. ## Simulation and Optimization By developing a simulation model, I tested various resource allocation and ambulance placement methods to identify the most effective approaches. This allows for exploration of different scenarios and assessments of their impact on response times. Parameters were set up for the number of simulations and ambulances, along with a maximum acceptable response time. Through an objective function, it then simulates various scenarios where the distribution of ambulances between different community settings is altered to discover the optimum allocation that minimizes average response time while penalizing instances exceeding the maximum allowed response time. This function repeatedly samples from different community segments of the data according to predefined numbers of allocated ambulances. It computes average times and penalties over multiple iterations to produce a measurable objective value. Using this function, an optimization routine seeks out the best possible division of ambulances between these community types under constraints ensuring total ambulance count remains constant. The optimized results determine how many ambulances should be designated to each area type, which theoretically leads to balanced responsiveness across geographies. For the histogram, a wider spread indicates more variability in response times, which could suggest inconsistency in service delivery. Overlapping areas in the histogram could indicate similarities between different community types.</p>
<div id="cell-F14" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>random.seed()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ambulance_raw</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation parameters</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> random.randint(<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>num_ambulances <span class="op">=</span> random.randint(<span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>max_response_time <span class="op">=</span> random.randint(<span class="dv">8</span>, <span class="dv">20</span>)  <span class="co"># minutes</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_simulations, num_ambulances, max_response_time)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># objective function for optimization</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> objective_function(params):</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    num_urban_ambulances, num_rural_ambulances, num_metro_ambulances, num_remote_ambulances, num_nostation_ambulances <span class="op">=</span> params</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    total_response_times <span class="op">=</span> []</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    total_hospital_times <span class="op">=</span> []</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        urban_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Urban'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        rural_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Rural'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        metro_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Metro'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        remote_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Remote'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        nostation_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'No-Station'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Randomly select calls based on the number of available ambulances</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        urban_calls <span class="op">=</span> urban_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_urban_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        rural_calls <span class="op">=</span> rural_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_rural_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        metro_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_metro_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        remote_calls <span class="op">=</span> remote_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_remote_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        nostation_calls <span class="op">=</span> nostation_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_nostation_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the response times and hospital times for the selected calls</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        response_times <span class="op">=</span> (urban_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span> rural_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>                          metro_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span> remote_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                          nostation_calls[<span class="st">'Resp_Time'</span>].tolist())</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        hospital_times <span class="op">=</span> (urban_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span> rural_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>                          metro_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span> remote_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>                          nostation_calls[<span class="st">'To_Hosp'</span>].tolist())</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        total_response_times.extend(response_times)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        total_hospital_times.extend(hospital_times)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    avg_response_time <span class="op">=</span> np.mean(total_response_times)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    penalty <span class="op">=</span> np.<span class="bu">sum</span>(np.array(total_response_times) <span class="op">&gt;</span> max_response_time)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_response_time <span class="op">+</span> penalty</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> [(<span class="dv">0</span>, num_ambulances) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>constraints <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> num_ambulances})</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(objective_function, x0<span class="op">=</span>[num_ambulances<span class="op">//</span><span class="dv">5</span>]<span class="op">*</span><span class="dv">5</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>optimized_urban_ambulances, optimized_rural_ambulances, optimized_metro_ambulances, optimized_remote_ambulances, optimized_nostation_ambulances <span class="op">=</span> result.x</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optimized Allocation:"</span>)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Urban Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_urban_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Rural Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_rural_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Metro Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_metro_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Remote Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_remote_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"No-Station Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_nostation_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the simulation with the optimized allocation</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>urban_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Urban'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>rural_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Rural'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>metro_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Metro'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>remote_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Remote'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>nostation_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'No-Station'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>urban_calls <span class="op">=</span> urban_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_urban_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>rural_calls <span class="op">=</span> rural_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_rural_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>metro_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_metro_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>remote_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_remote_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>nostation_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_nostation_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>urban_response_times <span class="op">=</span> urban_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>rural_response_times <span class="op">=</span> rural_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>metro_response_times <span class="op">=</span> metro_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>remote_response_times <span class="op">=</span> remote_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>nostation_response_times <span class="op">=</span> nostation_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>plt.hist(urban_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Urban'</span>)</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>plt.hist(rural_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Rural'</span>)</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>plt.hist(metro_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Metro'</span>)</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>plt.hist(remote_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Remote'</span>)</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>plt.hist(nostation_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'No-Station'</span>)</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time (minutes)'</span>)</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Time Distribution'</span>)</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>3 31 12
Optimized Allocation:
Urban Ambulances: 6
Rural Ambulances: 6
Metro Ambulances: 6
Remote Ambulances: 6
No-Station Ambulances: 6</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/f14-output-2.png" id="f14" width="829" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="forecasting-elapsed-times" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-elapsed-times">Forecasting Elapsed Times:</h2>
<p>I compared the performance of various algorithms, presenting evaluation metrics and model comparison tables to showcase their effectiveness. I focused on the time the crew gets dispatched to when the crew arrives at the hospital. I used 70% of the data for training and 30% for testing since I believe it is appropriate for the amount of data there is. All times with missing values were removed. I could have optimized these models more, but it was taking a long time to run so I did not implement it. I removed columns that lists the specific cities since there are redacted values. The Community type is good enough to explain location. All predictors were used to model the elapsed time from dispatch to hospital for the cases that are applicable. First I used a linear model to forecast the elapsed time:</p>
<div id="d0dc8675" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw.sample(frac<span class="op">=</span><span class="dv">1</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Response_Mode_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Response_Mode_Initial'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Mode_Final'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Response_Mode_Final'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Response_Mode_Final'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Det_Code_Init'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Det_Code_Init'</span>].isin([<span class="st">'.'</span>])]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw.drop([<span class="st">'Call_Loc_Community'</span>],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ambulance_raw.drop(ambulance_raw[(ambulance_raw[<span class="st">'To_Hosp'</span>].isnull()) <span class="op">|</span> (ambulance_raw[<span class="st">'Resp_Time'</span>].isnull())].index)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> ambulance_raw.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>catagorical_uniques <span class="op">=</span> ambulance_raw[categorical_columns].nunique()</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>low_cardinality_columns <span class="op">=</span> catagorical_uniques[catagorical_uniques <span class="op">&lt;=</span> <span class="dv">14</span>].index</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>ambulance_raw1 <span class="op">=</span> pd.get_dummies(ambulance_raw, columns<span class="op">=</span>low_cardinality_columns, drop_first<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\rzhon\AppData\Local\Temp\ipykernel_12868\3833265565.py:1: DtypeWarning:

Columns (3,6) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
</div>
<div id="32b24263" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ambulance_raw1[<span class="st">'MPDS_Code_Init'</span>] <span class="op">=</span> label_encoder.fit_transform(ambulance_raw1[<span class="st">'MPDS_Code_Initial'</span>])</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ambulance_raw1[<span class="st">'MPDS_Code_Fin'</span>] <span class="op">=</span> label_encoder.fit_transform(ambulance_raw1[<span class="st">'MPDS_Code_Final'</span>])</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ambulance_raw1 <span class="op">=</span> ambulance_raw1.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="92180c80" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>droppedfeatures <span class="op">=</span> [<span class="st">'To_Hosp'</span>, <span class="st">'MPDS_Code_Initial'</span>, <span class="st">'MPDS_Code_Final'</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ambulance_raw1.drop(droppedfeatures, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ambulance_raw1[<span class="st">'To_Hosp'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2a4f758e" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>random.seed()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="f3791728" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># :inear regression model</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluating the model</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>mean_squared_error(y_test, y_pred), r2_score(y_test, y_pred)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_test, y_pred, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual vs Predicted Time to Hospital'</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Actual Time to Hospital (Min)'</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Predicted Time to Hospital (Min)'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="bu">min</span>(y_test), <span class="bu">max</span>(y_test)], [<span class="bu">min</span>(y_test), <span class="bu">max</span>(y_test)], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-23-output-1.png" width="833" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f9cac505" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get residuals plot</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_pred</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, residuals, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residuals of Predictions'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Time to Hospital'</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Residuals'</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-24-output-1.png" width="829" height="529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The linear model had an R-squared score of 0.51, which is usually not great, but in this case I think it is pretty well since there are alot of other factors that influence the elapsed time from when an ambulance crew gets dispatched to when they arrive at the hospital. The residuals of predictions seem good since there are no patterns and the Residuals have a decent spread.</p>
<div id="7f430b70" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create polynomial features for Response time</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>poly_features_cubic <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">3</span>, include_bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>X_cubic <span class="op">=</span> poly_features_cubic.fit_transform(X_train[[<span class="st">'Resp_Time'</span>]])</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate polynomial features to the original features</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>X_train_cubic <span class="op">=</span> np.hstack([X_train.drop([<span class="st">'Resp_Time'</span>], axis<span class="op">=</span><span class="dv">1</span>), X_cubic])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Polynomial Regression</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>model_cubic <span class="op">=</span> LinearRegression()</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>model_cubic.fit(X_train_cubic, y_train)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>X_test_cubic <span class="op">=</span> poly_features_cubic.transform(X_test[[<span class="st">'Resp_Time'</span>]])</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>X_test_cubic <span class="op">=</span> np.hstack([X_test.drop([<span class="st">'Resp_Time'</span>], axis<span class="op">=</span><span class="dv">1</span>), X_test_cubic])</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>y_pred_cubic <span class="op">=</span> model_cubic.predict(X_test_cubic)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>mse_cubic <span class="op">=</span> mean_squared_error(y_test, y_pred_cubic)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>r2_cubic <span class="op">=</span> r2_score(y_test, y_pred_cubic)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cubic Model MSE: </span><span class="sc">{</span>mse_cubic<span class="sc">}</span><span class="ss">, R2: </span><span class="sc">{</span>r2_cubic<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Incorporating Polynomials(Cubic) in linear model"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">'Resp_Time'</span>], y_test, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Original data'</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">'Resp_Time'</span>], y_pred_cubic, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Cubic fit'</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time'</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Time to Hospital'</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Cubic Model MSE: 258.5249662135555, R2: 0.4930969541940049</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-25-output-2.png" width="605" height="455" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here I did a simple linear regression with only the response time as the predictor. When I implemented a cubic fit, the predictions were more consistent and linear.</p>
<div id="c5b746a7" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>), n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>RandomForestRegressor(n_jobs=1, random_state=89)</code></pre>
</div>
</div>
<div id="9cb7076f" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>predictions_rf <span class="op">=</span> rf_model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="25746aff" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RF MSE:"</span>, mean_squared_error(y_test, predictions_rf))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rf R2 Score:"</span>, r2_score(y_test, predictions_rf))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X.columns, <span class="st">'Importance'</span>: rf_model.feature_importances_})</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>plt.barh(features_df[<span class="st">'Feature'</span>], features_df[<span class="st">'Importance'</span>])</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importances in Predicting Time to Hospital(Random Forest)'</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_yaxis()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>RF MSE: 301.15256818355596
Rf R2 Score: 0.40951484763587287</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-28-output-2.png" width="1136" height="677" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I fitted a random forest model. The R-squared score was around 0.42. I used the default amount of estimators which is 100. The time it takes to respond to the scene was the most important feature, with the MPDS_Codes, following along. This makes sense since the response time is part of the total elapsed time it takes to get to the hospital</p>
<div id="ffba98de" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingRegressor</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Boosting Regressor</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>gb_model <span class="op">=</span> GradientBoostingRegressor(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>gb_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>GradientBoostingRegressor(random_state=96)</code></pre>
</div>
</div>
<div id="ea56a55b" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>gb_y_pred <span class="op">=</span> gb_model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2aa01fd2" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Gradient Boosting MSE:'</span>, mean_squared_error(y_test, gb_y_pred))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Gradient Boosting R2:'</span>, r2_score(y_test, gb_y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Gradient Boosting MSE: 250.80248341046138
Gradient Boosting R2: 0.5082388188711642</code></pre>
</div>
</div>
<div id="ba561691" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting feature importance</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X.columns, <span class="st">'Importance'</span>: gb_model.feature_importances_})</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>plt.barh(features_df[<span class="st">'Feature'</span>], features_df[<span class="st">'Importance'</span>])</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importances in Predicting Time to Hospital(Gradient boost)'</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_yaxis()</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-32-output-1.png" width="1136" height="677" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I implemented gradient boosting with 100 estimators. I set the max depth to 3 for balance(preventing overfitting). The r-squared score is similar to the linear model at around 0.52 at random_state = 42. The most important feature was also response time, with community type following along.</p>
<div id="89d35d4c" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>xgb_regressor <span class="op">=</span> XGBRegressor()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>xgb_regressor.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\rzhon\anaconda3\lib\site-packages\xgboost\compat.py:36: FutureWarning:

pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.

C:\Users\rzhon\anaconda3\lib\site-packages\xgboost\data.py:250: FutureWarning:

pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>XGBRegressor(base_score=0.5, booster='gbtree', colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, enable_categorical=False,
             gamma=0, gpu_id=-1, importance_type=None,
             interaction_constraints='', learning_rate=0.300000012,
             max_delta_step=0, max_depth=6, min_child_weight=1, missing=nan,
             monotone_constraints='()', n_estimators=100, n_jobs=4,
             num_parallel_tree=1, predictor='auto', random_state=0, reg_alpha=0,
             reg_lambda=1, scale_pos_weight=1, subsample=1, tree_method='exact',
             validate_parameters=1, verbosity=None)</code></pre>
</div>
</div>
<div id="6b40da4a" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>gb1_y_pred <span class="op">=</span> xgb_regressor.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="29fda519" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'XGBoost MSE:'</span>, mean_squared_error(y_test, gb1_y_pred))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'XGBoost R2:'</span>, mean_squared_error(y_test, gb1_y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>XGBoost MSE: 248.50759467495973
XGBoost R2: 248.50759467495973</code></pre>
</div>
</div>
<div id="38770eb5" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> xgb_regressor.feature_importances_</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.barh(X.columns, feature_importance)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importance in Predicting Time to Hosptial(XGBoost)'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="blog_files/figure-html/cell-36-output-1.png" width="1116" height="657" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I also implemented XGBoost which should be slightly better than the original gradient boosting model. The r-squared values is around 0.53 at random_state = 42. The result supported the original model that response time was is the most important features, with community type following along. ## Conclusion: Following the implementation of the revised resource allocation plan, BCEHS continued to transform and improve its services. This included increasing the number of paramedics and ambulances and introducing a new dispatch approach aimed at shortening response times for patients who need care most. Post-2014, there was a noted need for improved coordination of access to emergency health services with fire departments. This was identified as a key area where performance could be enhanced to ensure more effective emergency responses. BCEHS also recognized the need to evaluate its advanced care coverage across the province to determine whether it was sufficiently meeting the needs of patients, especially in rural and remote communities. This evaluation was part of an ongoing effort to ensure equitable access to emergency medical services throughout British Columbia. Recently, there was a reconstitution of the BCEHS board of directors to focus solely on ambulance services, with direct accountability to the Minister of Health. There was an appointment of a new chief ambulance officer responsible for the day-to-day management of the BC Ambulance Service. Funding for 85 new full-time paramedics, 30 full-time dispatchers, 22 new ambulances, and converting 22 rural ambulance stations to 24/7 ALPHA stations. In October 2021, 22 ambulance stations were converted from on-call paramedic staffing to 24/7 stations with 8 full-time paramedics. Also in 2021, there was expanded first responder capabilities that increased the care that first responders can provide, including additional diagnostic testing and administering epinephrine for life-threatening allergic reactions.</p>
<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-A3" class="csl-entry" role="listitem">
<span>“ACCESS TO EMERGENCY HEALTH SERVICES.”</span> 2019. <em>Office of the Auditor General of British Columbia</em>, 3–36.
</div>
<div id="ref-A5" class="csl-entry" role="listitem">
<span>“B.c. Acting to Improve Ambulance Response Times, Support Emergency Workers.”</span> 2021. <em>BC Gov News Ministry of Health</em>.
</div>
<div id="ref-besserer2013patterns" class="csl-entry" role="listitem">
Besserer, Floyd A, and Nadine R Caron. 2013. <span>“Patterns of Outdoor Recreational Injury in Northern British Columbia.”</span> <em>Wilderness &amp; Environmental Medicine</em> 24 (4): 397–401.
</div>
<div id="ref-A7" class="csl-entry" role="listitem">
<span>“Changes Enhance Emergency Care for British Columbians.”</span> 2021. <em>BC Gov News Ministry of Health</em>.
</div>
<div id="ref-dowbritish" class="csl-entry" role="listitem">
Dow, M. n.d. <span>“British Columbia Ambulance Service Resource Allocation Plan: An Analysis of Recent Changes to Call Codes, 2014.”</span> <em>Centre for Public Safety and Criminal Justice Research, School of Criminology and Criminal Justice, University of the Fraser Valley</em>.
</div>
<div id="ref-A1" class="csl-entry" role="listitem">
<span>“Emergency Service Response Codes.”</span> n.d. <em>Wikipedia</em>.
</div>
<div id="ref-A4" class="csl-entry" role="listitem">
<span>“Injury Prevention Tips.”</span> n.d. <em>Provincial Health Services Authority</em>.
</div>
<div id="ref-A2" class="csl-entry" role="listitem">
Power, Brian. n.d. <span>“Medical Priority Dispatch System,”</span> 18–19.
</div>
<div id="ref-A6" class="csl-entry" role="listitem">
<span>“Province Making Progress Strengthening Ambulance System.”</span> 2021. <em>BC Gov News Ministry of Health</em>.
</div>
<div id="ref-rajabali2019association" class="csl-entry" role="listitem">
Rajabali, Fahra, Alex Zheng, Kate Turcotte, Li Rita Zhang, Diana Kao, Drona Rasali, Megan Oakey, and Ian Pike. 2019. <span>“The Association of Material Deprivation Component Measures with Injury Hospital Separations in British Columbia, Canada.”</span> <em>Injury Epidemiology</em> 6: 1–9.
</div>
<div id="ref-A8" class="csl-entry" role="listitem">
<span>“THE CASE FOR INJURY PREVENTION.”</span> n.d. <em>BC Injury Research and Prevention Unit</em>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Overview of British Colombia EMS activity (2009-2014)"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Spring 2024"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Robert Zhong"</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: default</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">    rendering: embed-resources</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="an">nocite:</span><span class="co"> |</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co">  @*</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># BCEHS activity 2009-2014</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="al">![BCEHS](https://th.bing.com/th/id/OIG3.fShD12tDxLSbu1nrvUnW?w=1024&amp;h=1024&amp;rs=1&amp;pid=ImgDetMain)</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>Suppose someone is enjoying their day, maybe sipping on a cup of tea, when suddenly, life throws them a curveball, and they find themselves in need of medical assistance. In those moments, the efficiency of the EMS can make all the difference between a happy ending and a not so happy one, depending on how one views it. There are some people who wonder what goes on behind the scenes and what factors influence efficiency. This article explores British Columbia's EMS department, the largest provider of emergency healthcare in Canada and the second-busiest EMS service in North America. Using data from the Provincial Health Services Authority, I will explore  the factors that contribute to the efficiency of the EMS in British Columbia.and find more information on how these various operational and logistical elements impact overall EMS efficiency and patient outcomes in British Columbia. Identifying strengths, weaknesses, and areas for improvement could help inform best practices for other major EMS providers as well.</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preprocessing:</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> make_scorer</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop\Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing duplicate values for resposne mode intital</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Response_Mode_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Response_Mode_Initial'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing duplicate values for resposne mode final</span></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Response_Mode_Final'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Response_Mode_Final'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Response_Mode_Final'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'Det_Code_Init'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>cleaned_raw <span class="op">=</span> cleaned_raw[<span class="op">~</span>cleaned_raw[<span class="st">'Det_Code_Init'</span>].isin([<span class="st">'.'</span>])]</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing descriptions</span></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> pd.read_excel(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data\MPDS_Codes_and_RAP_Changes.xlsx"</span>)</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>mpds_codes.columns <span class="op">=</span> [c.strip() <span class="cf">for</span> c <span class="kw">in</span> mpds_codes.columns]</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.<span class="bu">apply</span>(<span class="kw">lambda</span> col: col.<span class="bu">str</span>.strip() <span class="cf">if</span> col.dtype <span class="op">==</span> <span class="st">"object"</span> <span class="cf">else</span> col)</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganize</span></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.iloc[<span class="dv">2</span>:].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>mpds_codes.columns <span class="op">=</span> mpds_codes.iloc[<span class="dv">0</span>]</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes[<span class="dv">1</span>:].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>mpds_codes <span class="op">=</span> mpds_codes.rename(columns<span class="op">=</span>{<span class="st">'MPDS Code'</span>: <span class="st">'MPDS_Code'</span>, <span class="st">'Description'</span>: <span class="st">'Description'</span>})</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>mpds_codes[<span class="st">'MPDS_Code'</span>] <span class="op">=</span> mpds_codes[<span class="st">'MPDS_Code'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>mpds_codes[<span class="st">'MPDS_Code'</span>] <span class="op">=</span> mpds_codes[<span class="st">'MPDS_Code'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Add descriptions to ambulance_raw dataframe</span></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a>joined_df <span class="op">=</span> ambulance_raw.merge(mpds_codes, how<span class="op">=</span><span class="st">'inner'</span>, left_on<span class="op">=</span><span class="st">'MPDS_Code_Final'</span>, right_on<span class="op">=</span><span class="st">'MPDS_Code'</span>)</span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temporal Patterns:</span></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>By examining response times across different years, I uncover the ebb and flow of emergency calls. Moreover, I will investigate the impact of community type on response times, shedding light on the challenges faced by different communities. </span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F1</span></span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a>commonincidents <span class="op">=</span> joined_df[<span class="st">'Description'</span>].value_counts().head(<span class="dv">10</span>).index</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter</span></span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>top10 <span class="op">=</span> joined_df[joined_df[<span class="st">'Description'</span>].isin(commonincidents)]</span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Get average response time for each year and description</span></span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>avg_response_time <span class="op">=</span> top10.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Description'</span>])[<span class="st">'Resp_Time'</span>].mean().unstack()</span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> description <span class="kw">in</span> commonincidents:</span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>    plt.plot(avg_response_time.index, avg_response_time[description], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>description)</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Response Time (minutes)'</span>)</span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Response Time by Call Year for Top 10 Most Common Incidents'</span>)</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Most Common Initial Call Cases (Top 10)'</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="fl">.8</span>))</span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>"TRANSFER- ACUITY I (No priority symptoms)" means that the patient is being transferred between healthcare facilities, their condition is stable, and they do not have any symptoms that would require a higher priority transfer. This type of transfer is generally not considered an emergency and may be scheduled in advance.</span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F2</span></span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure time is poitive number</span></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Resp_Time'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'Community_Type'</span>, y<span class="op">=</span><span class="st">'Resp_Time'</span>, data<span class="op">=</span>ambulance_raw)</span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Time Across Different Types of Communities'</span>)</span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Response Time (min)'</span>)</span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('FinalProjPoster2.svg', format='svg')</span></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a>From the boxplots, No-station communities usually have to wait a longer period for first responders to arrive. The population density is low and there is no dedicated police station or full-time law enforcement officers stationed within the community. Due to the distance between the community and the nearest police station, response times for emergency services may be longer. The cases that need more attention have a faster response time. Predominantly, the incidents revolve around respiratory difficulties and falls. These times have remained very consistent over the years. Some of the cases that are more severe are like automobiles where dirty oils/fluids and air filters are not given priority, then they start getting sick and problems occur. Same happens with tropical storms when they don't have access to warm waters and moist air.</span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F3</span></span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a>plt.hist(ambulance_raw[<span class="st">'Community_Type'</span>], bins<span class="op">=</span><span class="dv">5</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Type of Community'</span>)</span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency(millions)'</span>)</span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of EMS events through different Communties'</span>)</span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a>The amount of cases in Remote and No-Station areas is minimal. Metro areas have the most cases usually because of the population density, along with more infrastructure and pollution. Furthermore, the amounts of cases have been increasing over the years for metro and urban communities.</span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F4</span></span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a>community_types <span class="op">=</span> [<span class="st">'Metro'</span>, <span class="st">'Urban'</span>, <span class="st">'Rural'</span>, <span class="st">'Remote'</span>, <span class="st">'No-Station'</span>]</span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year and community type</span></span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> community_type <span class="kw">in</span> community_types:</span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a>    community_data <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Community_Type'</span>] <span class="op">==</span> community_type]</span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a>    call_frequencies <span class="op">=</span> community_data.groupby(<span class="st">'Call_Year'</span>).size()</span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a>    call_frequencies.plot(kind<span class="op">=</span><span class="st">'line'</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span>community_type)</span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Emergency Cases Over Time (2009-2014)'</span>)</span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a>Rural, Remote, and No-station areas have a fairly consistent amount of calls annually. The less people, the less things change over time. </span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a><span class="fu">## Decoding the Incident: </span></span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a>The nature of the call and its assigned priority can greatly affect response times. I examine the variety of call types and their associated response times, and explore the relationship between initial and final call codes. Sometimes, the initial assessment of an emergency might differ from the final diagnosis. I also assess the impact of changes to the Resource Allocation Plan on call prioritization.</span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F5</span></span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| # Distribution of differnetn cases</span></span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a>top_20 <span class="op">=</span> joined_df[<span class="st">'Description'</span>].value_counts().head(<span class="dv">20</span>)</span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a>top_20.plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Frequency'</span>)</span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Incident'</span>)</span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Top 20 Most Common EMS Cases'</span>)</span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a>This is a more in depth part of @F1. Some of the cases are very common. In BC, injuries from falls and transport incidents have resulted in the highest number of years lived with disability, while unintentional poisoning and injuries from self-harm have resulted in the highest number of years of life lost, with the gross cost per disability-adjusted life years for these causes ranging from $547 million to $922 million. BC’s diverse landscape includes mountains, forests, and coastal regions, leading to various outdoor activities and potential risks. The residents often engage in outdoor activities such as hiking, skiing, and cycling, which come with inherent injury risks, with peak injury months being August and September. According to B.C’s provincial trauma registry, of the five popular winter sports, the greatest amount of injuries leading to hospitalization in British Columbia happen to skiers and snowboarders.Transport incidents are also prevalent partly due to the high volume of traffic on British Columbia's roads, particularly in metro and urban areas. Due to colder climates, some diseases could spread easier which can lead to illness. Fainting could be due to illness; It can also be due to unintentional poisoning one way or another.</span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F6</span></span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a><span class="co">#Getting percent change between inital and final, then making pie charts</span></span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a>responsechangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'Response_Mode_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a>mpdschangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'MPDS_Code_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a>determinantchangepercentage <span class="op">=</span> (cleaned_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">!=</span> cleaned_raw[<span class="st">'Det_Code_Final'</span>]).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'No Change'</span>, <span class="st">'Change'</span>]</span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'lightcoral'</span>, <span class="st">'lightskyblue'</span>]</span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a>explode <span class="op">=</span> (<span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> responsechangepercentage, responsechangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Change Percentage'</span>)</span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-182"><a href="#cb51-182" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb51-183"><a href="#cb51-183" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> mpdschangepercentage, mpdschangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MPDS Change Percentage'</span>)</span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a>plt.pie([<span class="dv">100</span> <span class="op">-</span> determinantchangepercentage, determinantchangepercentage], labels<span class="op">=</span>labels, colors<span class="op">=</span>colors, explode<span class="op">=</span>explode, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, startangle<span class="op">=</span><span class="dv">140</span>)</span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'equal'</span>)</span>
<span id="cb51-190"><a href="#cb51-190" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Determinant Change Percentage'</span>)</span>
<span id="cb51-191"><a href="#cb51-191" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-195"><a href="#cb51-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F7</span></span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of avg resp time between changed and unchanged cases</span></span>
<span id="cb51-198"><a href="#cb51-198" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'code_change'</span>] <span class="op">=</span> ambulance_raw.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No Change'</span> <span class="cf">if</span> x[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">==</span> x[<span class="st">'MPDS_Code_Final'</span>] <span class="cf">else</span> <span class="st">'Changed'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-199"><a href="#cb51-199" aria-hidden="true" tabindex="-1"></a>avgresponsebychange <span class="op">=</span> ambulance_raw.groupby(<span class="st">'code_change'</span>)[<span class="st">'To_Hosp'</span>].mean().reset_index()</span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a>avgresponsebychange.columns <span class="op">=</span> [<span class="st">'code_change'</span>, <span class="st">'avg_response_time'</span>]</span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>avgresponsebychange, x<span class="op">=</span><span class="st">'code_change'</span>, y<span class="op">=</span><span class="st">'avg_response_time'</span>)</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Effect of Code Change on Time to Hospital'</span>)</span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Code Change'</span>)</span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Time to Hospital (min)'</span>)</span>
<span id="cb51-206"><a href="#cb51-206" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.despine()</span></span>
<span id="cb51-207"><a href="#cb51-207" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a>Call types can change if the corresponding call is accually different from what was initially reported. There is a small portion of changes between Initial and Final MPDS codes. MPDS Codes are a subset of Determinant codes so it makes sense there is a slight bit more change. The difference between the time it takes to get to the hospital is a bit higher with change, but its not really noticeable.</span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F8</span></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouped bar plot of frequenct of reponse codes over the years.</span></span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a>frequencydata <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Mode_Initial'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a>pivot_table <span class="op">=</span> frequencydata.pivot(index<span class="op">=</span><span class="st">'Call_Year'</span>, columns<span class="op">=</span><span class="st">'Response_Mode_Initial'</span>, values<span class="op">=</span><span class="st">'Frequency'</span>)</span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a>pivot_table.plot(kind<span class="op">=</span><span class="st">'bar'</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Calls (2009-2014) by Response Code'</span>)</span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Cases'</span>)</span>
<span id="cb51-221"><a href="#cb51-221" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-222"><a href="#cb51-222" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Code'</span>)</span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Code 3 = Lights and Sirens; Code 2 = Lights w/o Sirens; Code 1 = No Lights and Sirens</span><span class="co">]</span></span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a>On October 2013, BCEHS  implemented a revised EMS resource allocation plan. This plan was designed to optimize the allocation of resources by prescribing the paramedic qualification that should respond and at what speed, as well as the associated potential first responder attendance for a given 911 call. This includes 74 incident codes that were reclassified from Code 2 to Code 3 calls. These modifications to call prioritization can have a significant impact on how emergency resources are deployed. I'll assess the effect of these changes on response times and call prioritization. In @F8, There is a noticeable increase in Response times from 2013-2014. The revision aimed to improve the appropriateness of responses to emergency calls, ensuring that resources were matched more effectively to the needs of the call.</span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F9</span></span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Bubble plots</span></span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a>location_grp <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Community_Type'</span>,<span class="st">'Response_Mode_Initial'</span>])</span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a>location_grp_ct <span class="op">=</span> location_grp[<span class="st">'MPDS_Code_Initial'</span>].count().reset_index()</span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a>ax.scatter(location_grp_ct[<span class="st">'Community_Type'</span>], location_grp_ct[<span class="st">'Response_Mode_Initial'</span>], s<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>]<span class="op">*</span><span class="fl">.005</span>, c<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Response Code'</span>)</span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Event types by Community and Response Codes'</span>)</span>
<span id="cb51-239"><a href="#cb51-239" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-240"><a href="#cb51-240" aria-hidden="true" tabindex="-1"></a>location_grp <span class="op">=</span> cleaned_raw.groupby([<span class="st">'Community_Type'</span>,<span class="st">'Det_Code_Init'</span>])</span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a>location_grp_ct <span class="op">=</span> location_grp[<span class="st">'MPDS_Code_Initial'</span>].count().reset_index()</span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a>ax.scatter(location_grp_ct[<span class="st">'Community_Type'</span>], location_grp_ct[<span class="st">'Det_Code_Init'</span>], s<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>]<span class="op">*</span><span class="fl">.005</span>, c<span class="op">=</span>location_grp_ct[<span class="st">'MPDS_Code_Initial'</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Community Type'</span>)</span>
<span id="cb51-245"><a href="#cb51-245" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Det Code'</span>)</span>
<span id="cb51-246"><a href="#cb51-246" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Event types by Community and Det Codes'</span>)</span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a>(Note: Here are what each Determinant Codes represent respectively<span class="co">[</span><span class="ot">Alpha: Typically involves non-life-threatening situations; Bravo:  Conditions that require prompt, but not immediate care; Charlie: Significant injuries or symptoms; Delta:  Represents a life-threatening emergency; Echo: High probability of immediate life-threat; Omega: For incidents that are non-life-threatening and may not need immediate medical intervention</span><span class="co">]</span>)</span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a>The bubble plots above are a more in depth look at @F3. It shows the distribution of different cases across different communities, response codes, and determination codes. The bigger and lighter a bubble is, the larger number of cases there are. The smaller and darker the bubble is, the smaller number of cases there are. The plots show that the amount of cases are proportional across the x-axis(Community Type) and y-axis(response code and determination code). There is nothing out of the ordinary. Overall, Responding code 3 is the most common and the cases with Determinant Codes A,B,C, and D are the most frequent. There's not much of Determinant code E which is the most severe.</span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a><span class="fu">## From Call to Hospital:</span></span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a>Dissecting the emergency response process, the analysis focuses on the various components that contribute to the overall response time. By examining the time elapsed from ambulance dispatch to on-scene arrival, and on-scene arrival to hospital arrival. </span>
<span id="cb51-256"><a href="#cb51-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-257"><a href="#cb51-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F10</span></span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Time distribution</span></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a>sns.histplot(ambulance_raw[<span class="st">'Resp_Time'</span>], bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Response Times'</span>)</span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time (min)'</span>)</span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a>What I noticed is that the response times from the call dispatch to when the emergency crew arrives on scene takes the shape of a normal distribution with a slight right skew. The vast portion is 10 minutes and less.</span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F11</span></span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a>ambulance_raw2 <span class="op">=</span> ambulance_raw</span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a>mbulance_raw2 <span class="op">=</span> ambulance_raw.drop(ambulance_raw[(ambulance_raw[<span class="st">'To_Hosp'</span>].isnull()) <span class="op">|</span> (ambulance_raw[<span class="st">'Resp_Time'</span>].isnull())].index)</span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a>ambulance_raw2[<span class="st">'TimeDifference'</span>] <span class="op">=</span> ambulance_raw2[<span class="st">'To_Hosp'</span>] <span class="op">-</span> ambulance_raw2[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> ambulance_raw2.select_dtypes(include<span class="op">=</span><span class="st">'number'</span>).columns:</span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>((ambulance_raw2[col] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>())</span>
<span id="cb51-276"><a href="#cb51-276" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ambulance_raw2[col] <span class="op">&lt;</span> <span class="dv">0</span>).<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb51-277"><a href="#cb51-277" aria-hidden="true" tabindex="-1"></a>        ambulance_raw2 <span class="op">=</span> ambulance_raw2[ambulance_raw2[col] <span class="op">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'Resp_Time'</span>, y<span class="op">=</span><span class="st">'TimeDifference'</span>, data<span class="op">=</span>ambulance_raw2, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> np.polyfit(ambulance_raw2[<span class="st">'Resp_Time'</span>], ambulance_raw2[<span class="st">'TimeDifference'</span>], <span class="dv">1</span>)</span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a>plt.plot(ambulance_raw2[<span class="st">'Resp_Time'</span>], p(ambulance_raw2[<span class="st">'Resp_Time'</span>]), <span class="st">"r--"</span>)</span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Time on Scene vs Time on scene to Hospital'</span>)</span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time to Scene (min)'</span>)</span>
<span id="cb51-285"><a href="#cb51-285" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Time from scene to Hospital (min)'</span>)</span>
<span id="cb51-286"><a href="#cb51-286" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a>@F11 above shows a scatterplot between Response Time to Scene and the elapsed time from when the EMS crew arrives on scene to when the crew arrives at the hospital. The plot does good showing patterns and outliers. There are so many observations that the data points can overlap so it's not great at identifying potential clusters. The outliers for the time from scene to hospital all have a high amount of minutes which could indicate inaccurate data entry or unusual/rare cases.</span>
<span id="cb51-291"><a href="#cb51-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-292"><a href="#cb51-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F12</span></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Time_Category'</span>] <span class="op">=</span> pd.cut(ambulance_raw[<span class="st">'Resp_Time'</span>],</span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a>                                                  bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">10</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a>                                                 labels<span class="op">=</span>[<span class="st">'&lt;10 min'</span>, <span class="st">'&gt;=10 min'</span>])</span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a>response_time_ct <span class="op">=</span> ambulance_raw.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Time_Category'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>response_time_ct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), color<span class="op">=</span>[<span class="st">'green'</span>, <span class="st">'red'</span>])</span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Yearly Calls by Response Times(2009-2014)'</span>)</span>
<span id="cb51-299"><a href="#cb51-299" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb51-300"><a href="#cb51-300" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Amount of Calls'</span>)</span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Time'</span>)</span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-309"><a href="#cb51-309" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F13</span></span>
<span id="cb51-310"><a href="#cb51-310" aria-hidden="true" tabindex="-1"></a>echo_calls <span class="op">=</span> ambulance_raw[ambulance_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">==</span> <span class="st">'E'</span>]</span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a>echo_calls[<span class="st">'Response_Time_Category'</span>] <span class="op">=</span> pd.cut(echo_calls[<span class="st">'Resp_Time'</span>],</span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a>                                              bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">10</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a>                                              labels<span class="op">=</span>[<span class="st">'&lt;10 min'</span>, <span class="st">'&gt;=10 min'</span>])</span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a>response_time_ct <span class="op">=</span> echo_calls.groupby([<span class="st">'Call_Year'</span>, <span class="st">'Response_Time_Category'</span>]).size().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-315"><a href="#cb51-315" aria-hidden="true" tabindex="-1"></a>response_time_ct.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), color<span class="op">=</span>[<span class="st">'green'</span>, <span class="st">'red'</span>])</span>
<span id="cb51-316"><a href="#cb51-316" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution Echo Calls by Response Time Category'</span>)</span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Amount of Calls'</span>)</span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Response Time Category'</span>, loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a>The bar plots indicates that amount of calls are going up over the years which aligns with @F4. The response time for Echo calls, which are the most urgent ones, generally on average always have faster response times proportionally than the overall amount of calls combined.</span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation and Optimization</span></span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a>By developing a simulation model, I tested various resource allocation and ambulance placement methods to identify the most effective approaches. This allows for exploration of different scenarios and assessments of their impact on response times. Parameters were set up for the number of simulations and ambulances, along with a maximum acceptable response time. Through an objective function, it then simulates various scenarios where the distribution of ambulances between different community settings is altered to discover the optimum allocation that minimizes average response time while penalizing instances exceeding the maximum allowed response time. This function repeatedly samples from different community segments of the data according to predefined numbers of allocated ambulances. It computes average times and penalties over multiple iterations to produce a measurable objective value. Using this function, an optimization routine seeks out the best possible division of ambulances between these community types under constraints ensuring total ambulance count remains constant. The optimized results determine how many ambulances should be designated to each area type, which theoretically leads to balanced responsiveness across geographies. For the histogram, a wider spread indicates more variability in response times, which could suggest inconsistency in service delivery. Overlapping areas in the histogram could indicate similarities between different community types.</span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: F14</span></span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb51-332"><a href="#cb51-332" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb51-333"><a href="#cb51-333" aria-hidden="true" tabindex="-1"></a>random.seed()</span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ambulance_raw</span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation parameters</span></span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a>num_simulations <span class="op">=</span> random.randint(<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a>num_ambulances <span class="op">=</span> random.randint(<span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a>max_response_time <span class="op">=</span> random.randint(<span class="dv">8</span>, <span class="dv">20</span>)  <span class="co"># minutes</span></span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_simulations, num_ambulances, max_response_time)</span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a><span class="co"># objective function for optimization</span></span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> objective_function(params):</span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>    num_urban_ambulances, num_rural_ambulances, num_metro_ambulances, num_remote_ambulances, num_nostation_ambulances <span class="op">=</span> params</span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a>    total_response_times <span class="op">=</span> []</span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a>    total_hospital_times <span class="op">=</span> []</span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a>        urban_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Urban'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a>        rural_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Rural'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-349"><a href="#cb51-349" aria-hidden="true" tabindex="-1"></a>        metro_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Metro'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-350"><a href="#cb51-350" aria-hidden="true" tabindex="-1"></a>        remote_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Remote'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a>        nostation_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'No-Station'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Randomly select calls based on the number of available ambulances</span></span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a>        urban_calls <span class="op">=</span> urban_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_urban_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-355"><a href="#cb51-355" aria-hidden="true" tabindex="-1"></a>        rural_calls <span class="op">=</span> rural_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_rural_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-356"><a href="#cb51-356" aria-hidden="true" tabindex="-1"></a>        metro_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_metro_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a>        remote_calls <span class="op">=</span> remote_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_remote_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a>        nostation_calls <span class="op">=</span> nostation_data.sample(n<span class="op">=</span><span class="bu">int</span>(num_nostation_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-359"><a href="#cb51-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-360"><a href="#cb51-360" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate the response times and hospital times for the selected calls</span></span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a>        response_times <span class="op">=</span> (urban_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span> rural_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span></span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a>                          metro_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span> remote_calls[<span class="st">'Resp_Time'</span>].tolist() <span class="op">+</span></span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a>                          nostation_calls[<span class="st">'Resp_Time'</span>].tolist())</span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a>        hospital_times <span class="op">=</span> (urban_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span> rural_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span></span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a>                          metro_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span> remote_calls[<span class="st">'To_Hosp'</span>].tolist() <span class="op">+</span></span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a>                          nostation_calls[<span class="st">'To_Hosp'</span>].tolist())</span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a>        total_response_times.extend(response_times)</span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a>        total_hospital_times.extend(hospital_times)</span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-371"><a href="#cb51-371" aria-hidden="true" tabindex="-1"></a>    avg_response_time <span class="op">=</span> np.mean(total_response_times)</span>
<span id="cb51-372"><a href="#cb51-372" aria-hidden="true" tabindex="-1"></a>    penalty <span class="op">=</span> np.<span class="bu">sum</span>(np.array(total_response_times) <span class="op">&gt;</span> max_response_time)</span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_response_time <span class="op">+</span> penalty</span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> [(<span class="dv">0</span>, num_ambulances) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a>constraints <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> num_ambulances})</span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(objective_function, x0<span class="op">=</span>[num_ambulances<span class="op">//</span><span class="dv">5</span>]<span class="op">*</span><span class="dv">5</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a>optimized_urban_ambulances, optimized_rural_ambulances, optimized_metro_ambulances, optimized_remote_ambulances, optimized_nostation_ambulances <span class="op">=</span> result.x</span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optimized Allocation:"</span>)</span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Urban Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_urban_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Rural Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_rural_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Metro Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_metro_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-384"><a href="#cb51-384" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Remote Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_remote_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-385"><a href="#cb51-385" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"No-Station Ambulances: </span><span class="sc">{</span><span class="bu">int</span>(optimized_nostation_ambulances)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the simulation with the optimized allocation</span></span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a>urban_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Urban'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-388"><a href="#cb51-388" aria-hidden="true" tabindex="-1"></a>rural_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Rural'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-389"><a href="#cb51-389" aria-hidden="true" tabindex="-1"></a>metro_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Metro'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a>remote_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'Remote'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a>nostation_data <span class="op">=</span> data[(data[<span class="st">'Community_Type'</span>] <span class="op">==</span> <span class="st">'No-Station'</span>) <span class="op">&amp;</span> (data[<span class="st">'Resp_Time'</span>].notnull())]</span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a>urban_calls <span class="op">=</span> urban_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_urban_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a>rural_calls <span class="op">=</span> rural_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_rural_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a>metro_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_metro_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a>remote_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_remote_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a>nostation_calls <span class="op">=</span> metro_data.sample(n<span class="op">=</span><span class="bu">int</span>(optimized_nostation_ambulances), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a>urban_response_times <span class="op">=</span> urban_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a>rural_response_times <span class="op">=</span> rural_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a>metro_response_times <span class="op">=</span> metro_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a>remote_response_times <span class="op">=</span> remote_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a>nostation_response_times <span class="op">=</span> nostation_calls[<span class="st">'Resp_Time'</span>]</span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-403"><a href="#cb51-403" aria-hidden="true" tabindex="-1"></a>plt.hist(urban_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Urban'</span>)</span>
<span id="cb51-404"><a href="#cb51-404" aria-hidden="true" tabindex="-1"></a>plt.hist(rural_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Rural'</span>)</span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a>plt.hist(metro_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Metro'</span>)</span>
<span id="cb51-406"><a href="#cb51-406" aria-hidden="true" tabindex="-1"></a>plt.hist(remote_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Remote'</span>)</span>
<span id="cb51-407"><a href="#cb51-407" aria-hidden="true" tabindex="-1"></a>plt.hist(nostation_response_times, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'No-Station'</span>)</span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time (minutes)'</span>)</span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Response Time Distribution'</span>)</span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## Forecasting Elapsed Times:</span></span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a>I compared the performance of various algorithms, presenting evaluation metrics and model comparison tables to showcase their effectiveness. I focused on the time the crew gets dispatched to when the crew arrives at the hospital. I used 70% of the data for training and 30% for testing since I believe it is appropriate for the amount of data there is. All times with missing values were removed. I could have optimized these models more, but it was taking a long time to run so I did not implement it. I removed columns that lists the specific cities since there are redacted values. The Community type is good enough to explain location. All predictors were used to model the elapsed time from dispatch to hospital for the cases that are applicable. First I used a linear model to forecast the elapsed time:</span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">rzhon</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">Data Capstone Final</span><span class="ch">\\</span><span class="st">capstone-1</span><span class="ch">\\</span><span class="st">B.C. Ambulance Raw Data</span><span class="ch">\\</span><span class="st">response_times_original_2009-2014.csv"</span>)</span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'MPDS_Code_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw.sample(frac<span class="op">=</span><span class="dv">1</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Mode_Initial'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Response_Mode_Initial'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-424"><a href="#cb51-424" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Response_Mode_Initial'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb51-425"><a href="#cb51-425" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Response_Mode_Final'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Response_Mode_Final'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Response_Mode_Final'</span>].isin([<span class="st">'.'</span>, <span class="st">'0'</span>])]</span>
<span id="cb51-427"><a href="#cb51-427" aria-hidden="true" tabindex="-1"></a>ambulance_raw[<span class="st">'Det_Code_Init'</span>] <span class="op">=</span> ambulance_raw[<span class="st">'Det_Code_Init'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb51-428"><a href="#cb51-428" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw[<span class="op">~</span>ambulance_raw[<span class="st">'Det_Code_Init'</span>].isin([<span class="st">'.'</span>])]</span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a>ambulance_raw <span class="op">=</span> ambulance_raw.drop([<span class="st">'Call_Loc_Community'</span>],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a>ambulance_raw.drop(ambulance_raw[(ambulance_raw[<span class="st">'To_Hosp'</span>].isnull()) <span class="op">|</span> (ambulance_raw[<span class="st">'Resp_Time'</span>].isnull())].index)</span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a>categorical_columns <span class="op">=</span> ambulance_raw.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns</span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a>catagorical_uniques <span class="op">=</span> ambulance_raw[categorical_columns].nunique()</span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a>low_cardinality_columns <span class="op">=</span> catagorical_uniques[catagorical_uniques <span class="op">&lt;=</span> <span class="dv">14</span>].index</span>
<span id="cb51-434"><a href="#cb51-434" aria-hidden="true" tabindex="-1"></a>ambulance_raw1 <span class="op">=</span> pd.get_dummies(ambulance_raw, columns<span class="op">=</span>low_cardinality_columns, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-435"><a href="#cb51-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a>ambulance_raw1[<span class="st">'MPDS_Code_Init'</span>] <span class="op">=</span> label_encoder.fit_transform(ambulance_raw1[<span class="st">'MPDS_Code_Initial'</span>])</span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a>ambulance_raw1[<span class="st">'MPDS_Code_Fin'</span>] <span class="op">=</span> label_encoder.fit_transform(ambulance_raw1[<span class="st">'MPDS_Code_Final'</span>])</span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a>ambulance_raw1 <span class="op">=</span> ambulance_raw1.dropna()</span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a>droppedfeatures <span class="op">=</span> [<span class="st">'To_Hosp'</span>, <span class="st">'MPDS_Code_Initial'</span>, <span class="st">'MPDS_Code_Final'</span>]</span>
<span id="cb51-449"><a href="#cb51-449" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ambulance_raw1.drop(droppedfeatures, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-450"><a href="#cb51-450" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ambulance_raw1[<span class="st">'To_Hosp'</span>]</span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a>random.seed()</span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>))</span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-462"><a href="#cb51-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-463"><a href="#cb51-463" aria-hidden="true" tabindex="-1"></a><span class="co"># :inear regression model</span></span>
<span id="cb51-464"><a href="#cb51-464" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb51-465"><a href="#cb51-465" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a>model.fit(X_train, y_train)</span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluating the model</span></span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a>mean_squared_error(y_test, y_pred), r2_score(y_test, y_pred)</span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_test, y_pred, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Actual vs Predicted Time to Hospital'</span>)</span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Actual Time to Hospital (Min)'</span>)</span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Predicted Time to Hospital (Min)'</span>)</span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="bu">min</span>(y_test), <span class="bu">max</span>(y_test)], [<span class="bu">min</span>(y_test), <span class="bu">max</span>(y_test)], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb51-479"><a href="#cb51-479" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-480"><a href="#cb51-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-483"><a href="#cb51-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Get residuals plot</span></span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_pred</span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_pred, residuals, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Residuals of Predictions'</span>)</span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Time to Hospital'</span>)</span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Residuals'</span>)</span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a>The linear model had an R-squared score of 0.51, which is usually not great, but in this case I think it is pretty well since there are alot of other factors that influence the elapsed time from when an ambulance crew gets dispatched to when they arrive at the hospital. The residuals of predictions seem good since there are no patterns and the Residuals have a decent spread.</span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a><span class="co"># Create polynomial features for Response time</span></span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a>poly_features_cubic <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">3</span>, include_bias<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-501"><a href="#cb51-501" aria-hidden="true" tabindex="-1"></a>X_cubic <span class="op">=</span> poly_features_cubic.fit_transform(X_train[[<span class="st">'Resp_Time'</span>]])</span>
<span id="cb51-502"><a href="#cb51-502" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate polynomial features to the original features</span></span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a>X_train_cubic <span class="op">=</span> np.hstack([X_train.drop([<span class="st">'Resp_Time'</span>], axis<span class="op">=</span><span class="dv">1</span>), X_cubic])</span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Polynomial Regression</span></span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a>model_cubic <span class="op">=</span> LinearRegression()</span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a>model_cubic.fit(X_train_cubic, y_train)</span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a>X_test_cubic <span class="op">=</span> poly_features_cubic.transform(X_test[[<span class="st">'Resp_Time'</span>]])</span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a>X_test_cubic <span class="op">=</span> np.hstack([X_test.drop([<span class="st">'Resp_Time'</span>], axis<span class="op">=</span><span class="dv">1</span>), X_test_cubic])</span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a>y_pred_cubic <span class="op">=</span> model_cubic.predict(X_test_cubic)</span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a>mse_cubic <span class="op">=</span> mean_squared_error(y_test, y_pred_cubic)</span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a>r2_cubic <span class="op">=</span> r2_score(y_test, y_pred_cubic)</span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cubic Model MSE: </span><span class="sc">{</span>mse_cubic<span class="sc">}</span><span class="ss">, R2: </span><span class="sc">{</span>r2_cubic<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-514"><a href="#cb51-514" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Incorporating Polynomials(Cubic) in linear model"</span>)</span>
<span id="cb51-515"><a href="#cb51-515" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">'Resp_Time'</span>], y_test, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Original data'</span>)</span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a>plt.scatter(X_test[<span class="st">'Resp_Time'</span>], y_pred_cubic, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Cubic fit'</span>)</span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Response Time'</span>)</span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Time to Hospital'</span>)</span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb51-520"><a href="#cb51-520" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-521"><a href="#cb51-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a>Here I did a simple linear regression with only the response time as the predictor. When I implemented a cubic fit, the predictions were more consistent and linear.</span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb51-527"><a href="#cb51-527" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>), n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb51-528"><a href="#cb51-528" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a>predictions_rf <span class="op">=</span> rf_model.predict(X_test)</span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RF MSE:"</span>, mean_squared_error(y_test, predictions_rf))</span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rf R2 Score:"</span>, r2_score(y_test, predictions_rf))</span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X.columns, <span class="st">'Importance'</span>: rf_model.feature_importances_})</span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a>plt.barh(features_df[<span class="st">'Feature'</span>], features_df[<span class="st">'Importance'</span>])</span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importances in Predicting Time to Hospital(Random Forest)'</span>)</span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_yaxis()</span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-550"><a href="#cb51-550" aria-hidden="true" tabindex="-1"></a>I fitted a random forest model. The R-squared score was around 0.42. I used the default amount of estimators which is 100. The time it takes to respond to the scene was the most important feature, with the MPDS_Codes, following along. This makes sense since the response time is part of the total elapsed time it takes to get to the hospital</span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingRegressor</span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Boosting Regressor</span></span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a>gb_model <span class="op">=</span> GradientBoostingRegressor(</span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span>random.randint(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a>gb_model.fit(X_train, y_train)</span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-566"><a href="#cb51-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-567"><a href="#cb51-567" aria-hidden="true" tabindex="-1"></a>gb_y_pred <span class="op">=</span> gb_model.predict(X_test)</span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Gradient Boosting MSE:'</span>, mean_squared_error(y_test, gb_y_pred))</span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Gradient Boosting R2:'</span>, r2_score(y_test, gb_y_pred))</span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting feature importance</span></span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X.columns, <span class="st">'Importance'</span>: gb_model.feature_importances_})</span>
<span id="cb51-580"><a href="#cb51-580" aria-hidden="true" tabindex="-1"></a>features_df <span class="op">=</span> features_df.sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-581"><a href="#cb51-581" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-582"><a href="#cb51-582" aria-hidden="true" tabindex="-1"></a>plt.barh(features_df[<span class="st">'Feature'</span>], features_df[<span class="st">'Importance'</span>])</span>
<span id="cb51-583"><a href="#cb51-583" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importances in Predicting Time to Hospital(Gradient boost)'</span>)</span>
<span id="cb51-584"><a href="#cb51-584" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb51-585"><a href="#cb51-585" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb51-586"><a href="#cb51-586" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_yaxis()</span>
<span id="cb51-587"><a href="#cb51-587" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-588"><a href="#cb51-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-589"><a href="#cb51-589" aria-hidden="true" tabindex="-1"></a>I implemented gradient boosting with 100 estimators. I set the max depth to 3 for balance(preventing overfitting). The r-squared score is similar to the linear model at around 0.52 at random_state = 42. The most important feature was also response time, with community type following along.</span>
<span id="cb51-592"><a href="#cb51-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-593"><a href="#cb51-593" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb51-594"><a href="#cb51-594" aria-hidden="true" tabindex="-1"></a>xgb_regressor <span class="op">=</span> XGBRegressor()</span>
<span id="cb51-595"><a href="#cb51-595" aria-hidden="true" tabindex="-1"></a>xgb_regressor.fit(X_train, y_train)</span>
<span id="cb51-596"><a href="#cb51-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-599"><a href="#cb51-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-600"><a href="#cb51-600" aria-hidden="true" tabindex="-1"></a>gb1_y_pred <span class="op">=</span> xgb_regressor.predict(X_test)</span>
<span id="cb51-601"><a href="#cb51-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-604"><a href="#cb51-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-605"><a href="#cb51-605" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'XGBoost MSE:'</span>, mean_squared_error(y_test, gb1_y_pred))</span>
<span id="cb51-606"><a href="#cb51-606" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'XGBoost R2:'</span>, mean_squared_error(y_test, gb1_y_pred))</span>
<span id="cb51-607"><a href="#cb51-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-610"><a href="#cb51-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb51-611"><a href="#cb51-611" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> xgb_regressor.feature_importances_</span>
<span id="cb51-612"><a href="#cb51-612" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-613"><a href="#cb51-613" aria-hidden="true" tabindex="-1"></a>plt.barh(X.columns, feature_importance)</span>
<span id="cb51-614"><a href="#cb51-614" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importance in Predicting Time to Hosptial(XGBoost)'</span>)</span>
<span id="cb51-615"><a href="#cb51-615" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-616"><a href="#cb51-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-617"><a href="#cb51-617" aria-hidden="true" tabindex="-1"></a>I also implemented XGBoost which should be slightly better than the original gradient boosting model. The r-squared values is around 0.53 at random_state = 42. The result supported the original model that response time was is the most important features, with community type following along.</span>
<span id="cb51-618"><a href="#cb51-618" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion:</span></span>
<span id="cb51-619"><a href="#cb51-619" aria-hidden="true" tabindex="-1"></a>Following the implementation of the revised resource allocation plan, BCEHS continued to transform and improve its services. This included increasing the number of paramedics and ambulances and introducing a new dispatch approach aimed at shortening response times for patients who need care most. Post-2014, there was a noted need for improved coordination of access to emergency health services with fire departments. This was identified as a key area where performance could be enhanced to ensure more effective emergency responses. BCEHS also recognized the need to evaluate its advanced care coverage across the province to determine whether it was sufficiently meeting the needs of patients, especially in rural and remote communities. This evaluation was part of an ongoing effort to ensure equitable access to emergency medical services throughout British Columbia. Recently, there was a reconstitution of the BCEHS board of directors to focus solely on ambulance services, with direct accountability to the Minister of Health. There was an appointment of a new chief ambulance officer responsible for the day-to-day management of the BC Ambulance Service. Funding for 85 new full-time paramedics, 30 full-time dispatchers, 22 new ambulances, and converting 22 rural ambulance stations to 24/7 ALPHA stations. In October 2021, 22 ambulance stations were converted from on-call paramedic staffing to 24/7 stations with 8 full-time paramedics. Also in 2021, there was expanded first responder capabilities that increased the care that first responders can provide, including additional diagnostic testing and administering epinephrine for life-threatening allergic reactions.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>